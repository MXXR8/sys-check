<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SLOTMATRIX</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    background: #0a0a0a;
    color: #e0e0e0;
    font-family: 'Courier New', Courier, monospace;
    font-size: 13px;
    min-height: 100vh;
    -webkit-user-select: none;
    user-select: none;
    overflow-x: hidden;
  }
  body { padding: 16px 16px 32px; }

  .section { margin-bottom: 20px; }
  .section-header {
    color: #fff;
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 1px;
    margin-bottom: 12px;
  }
  .divider { border: none; border-top: 1px solid #222; margin: 16px 0; }
  .stat-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    line-height: 1.6;
  }
  .stat-label { color: #666; }
  .stat-value { color: #00ff41; text-align: right; }
  .stat-value.white { color: #fff; }
  .active-dot {
    display: inline-block;
    width: 6px; height: 6px;
    border-radius: 50%;
    background: #00ff41;
    margin-right: 6px;
    animation: pulse 1.5s ease infinite;
  }
  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.3; } }

  .signal-item { padding: 8px 0; border-bottom: 1px solid #1a1a1a; }
  .signal-item:last-child { border-bottom: none; }
  .signal-top { display: flex; justify-content: space-between; align-items: center; }
  .signal-slot { color: #fff; font-size: 13px; }
  .signal-result { font-size: 12px; font-weight: bold; padding: 1px 6px; border-radius: 2px; }
  .result-hit { color: #00ff41; background: #0a1a0a; }
  .result-miss { color: #ff4444; background: #1a0a0a; }
  .result-pending { color: #ffd600; background: #1a1a0a; }
  .signal-meta { color: #555; font-size: 11px; margin-top: 2px; }
  .empty-state { color: #444; font-style: italic; padding: 12px 0; }

  .play-btn {
    display: block;
    width: 100%;
    padding: 14px;
    margin-top: 16px;
    background: #00ff41;
    color: #0a0a0a;
    border: none;
    font-family: inherit;
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 1px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
  }
</style>
</head>
<body>

<div id="app"></div>

<script>
(function() {
  var tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();
  tg.setHeaderColor('#0a0a0a');
  tg.setBackgroundColor('#0a0a0a');

  function decodeData() {
    try {
      var p = new URLSearchParams(window.location.search);
      var e = p.get('d');
      if (!e) return null;
      while (e.length % 4) e += '=';
      return JSON.parse(atob(e.replace(/-/g,'+').replace(/_/g,'/')));
    } catch(x) { return null; }
  }

  function esc(s) { var d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
  function flag(c) {
    if(!c||c.length!==2) return '\u{1F310}';
    return String.fromCodePoint(c.toUpperCase().charCodeAt(0)-65+0x1F1E6)
         + String.fromCodePoint(c.toUpperCase().charCodeAt(1)-65+0x1F1E6);
  }

  var d = decodeData();
  if (!d) {
    document.getElementById('app').innerHTML = '<div style="padding:20px;color:#ff4444;">error loading data.</div>';
    return;
  }

  var signals = d.s || 0;
  var bankroll = d.b || 0;
  var cc = d.cc || '';
  var cn = d.cn || 'Unknown';
  var pid = d.p || '?';
  var nextSig = d.ns || 'SCANNING...';
  var history = d.h || [];
  var sigRemaining = d.sr || 0;
  var sigLimit = d.sl || 2;
  var affLink = d.al || '';

  var html = '';

  html += '<div class="section"><div class="section-header">[SYSTEM DASHBOARD]</div>';
  html += '<div class="stat-row"><span class="stat-label">player</span><span class="stat-value white">'+esc(pid)+'</span></div>';
  html += '<div class="stat-row"><span class="stat-label">region</span><span class="stat-value">'+flag(cc)+' '+esc(cn)+'</span></div>';
  html += '<div class="stat-row"><span class="stat-label">bankroll</span><span class="stat-value">$'+bankroll+'</span></div>';
  html += '<div class="stat-row"><span class="stat-label">signals today</span><span class="stat-value">'+(sigLimit-sigRemaining)+' / '+sigLimit+'</span></div>';
  html += '<div class="stat-row"><span class="stat-label">total signals</span><span class="stat-value">'+signals+'</span></div>';
  html += '<div class="stat-row"><span class="stat-label">next signal</span><span class="stat-value"><span class="active-dot"></span>'+esc(nextSig)+'</span></div>';
  html += '</div>';

  if (affLink) {
    html += '<a class="play-btn" href="'+esc(affLink)+'" target="_blank">\u{1F7E2} PLAY NOW (SECURE LINK)</a>';
  }

  html += '<hr class="divider">';
  html += '<div class="section"><div class="section-header">[SIGNAL HISTORY]</div>';
  if (!history.length) {
    html += '<div class="empty-state">no signals recorded yet.</div>';
  } else {
    for (var i=0;i<history.length;i++) {
      var sig=history[i], res=sig[3]||'pending';
      var rc='result-pending',rt='\u23F3 PENDING';
      if(res==='hit'){rc='result-hit';rt='\u2705 HIT';}
      else if(res==='miss'){rc='result-miss';rt='\u274C MISS';}
      html += '<div class="signal-item"><div class="signal-top">';
      html += '<span class="signal-slot">'+esc(sig[1])+'</span>';
      html += '<span class="signal-result '+rc+'">'+rt+'</span></div>';
      html += '<div class="signal-meta">'+esc(sig[0])+' \u00B7 node #'+sig[2]+'</div></div>';
    }
  }
  html += '</div>';

  document.getElementById('app').innerHTML = html;
})();
</script>
</body>
</html>
